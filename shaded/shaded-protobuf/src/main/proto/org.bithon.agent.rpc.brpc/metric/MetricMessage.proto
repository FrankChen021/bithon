syntax = "proto3";

package org.bithon.agent.rpc.brpc.metrics;

option java_multiple_files = true;

message BrpcHttpIncomingMetricMessage {
    int64 timestamp         = 1;
    int32 interval          = 2;
    optional string srcApplication = 3;
    string uri            = 4;

    int64 minResponseTime   = 5;
    int64 responseTime      = 6;
    int64 maxResponseTime   = 7;
    int64 totalCount        = 8;
    int64 errorCount        = 9;
    int64 okCount           = 10;
    int64 count4xx          = 11;
    int64 count5xx          = 12;
    int64 requestBytes      = 13;
    int64 responseBytes     = 14;
    int64 flowedCount       = 15;
    int64 degradedCount     = 16;
}

/***************************************************************************/
/*************************** JVM Metrics ***********************************/
/***************************************************************************/
message BrpcJvmMetricMessage {
    int64 timestamp = 1;
    int32 interval  = 2;

    // how long the application run in millisecond
    int64 instanceUpTime = 3; 
    
    // start timestamp in milli second     
    int64 instanceStartTime = 4;
    int64 processors = 5;
    
    // process cpu time in this interval in nano second
    int64 processCpuTime = 6;     
    double systemLoadAvg = 7;
    double processCpuLoad = 8;

    int64 totalMemBytes = 9;
    int64 freeMemBytes  = 10;

    // approximately to -Xmx
    int64 heapMax       = 11;
    
    // approximate to -Xms     
    int64 heapInit      = 12;
    int64 heapUsed      = 13;
    int64 heapCommitted = 14;

    //
    // heap
    //
    // -XX:MaxPermSize
    int64 nonHeapMax = 15;
    // -XX:PermSize
    int64 nonHeapInit = 16; 
    int64 nonHeapUsed = 17;
    int64 nonHeapCommitted = 18;

    //
    // threads
    //
    int64 peakThreads = 19;
    int64 daemonThreads = 20;
    int64 totalThreads = 21;
    int64 activeThreads = 22;

    //
    // class
    //
    int64 classLoaded = 23;
    int64 classUnloaded =24;

    //
    // meta
    //
    int64 metaspaceCommitted = 25;
    int64 metaspaceUsed      = 26;
    int64 metaspaceInit      = 27;
    int64 metaspaceMax       = 28;
    int64 directMax          = 29;
    int64 directUsed         = 30;
}

message BrpcJvmGcMetricMessage {
    int64 timestamp = 1;
    int32 interval = 2;
    string gcName = 3;
    string generation = 4;
    int64 gcCount = 5;
    int64 gcTime = 6;
}

/***************************************************************************/
/************************* Web Server Metrics ******************************/
/***************************************************************************/
message BrpcWebServerMetricMessage {
    int64 timestamp = 1;
    int32 interval  = 2;
    string type   = 3;
    int64 connectionCount = 4;
    int64 maxConnections = 5;
    int64 activeThreads = 6;
    int64 maxThreads = 7;
}

/***************************************************************************/
/***************************  Application Exception ************************/
/**************************************************************************/
message BrpcExceptionMetricMessage {
    int64 timestamp  =1;
    int32 interval  = 2;
    string className =3;
    string message = 4;
    string stackTrace =5;
    string uri = 6;
    int64 exceptionCount =7;
}

/***************************************************************************/
/******************* Http Client *******************************************/
/**************************************************************************/
message BrpcHttpOutgoingMetricMessage {
    int64 timestamp           =  1;
    int32 interval            =  2;
    string uri              =  3;
    string method           =  4;
    int64 responseTime        =  5;
    int64 minResponseTime     =  6;
    int64 maxResponseTime     =  7;
    int64 count4xx            =  8;
    int64 count5xx            =  9;
    int64 requestCount        = 10;
    int64 exceptionCount      = 11;
    int64 requestBytes        = 12;
    int64 responseBytes       = 13;
}

/***************************************************************************/
/******************* Thread Pool ******************************************/
/**************************************************************************/
message BrpcThreadPoolMetricMessage {
    int64 timestamp                 =  1;
    int32 interval                  =  2;
    string executorClass          =  3;
    string poolName               =  4;
    int64 callerRunTaskCount        =  5;
    int64 abortedTaskCount          =  6;
    int64 discardedTaskCount        =  7;
    int64 discardedOldestTaskCount  =  8;
    int64 exceptionTaskCount        =  9;
    int64 successfulTaskCount       =  10;
    int64 totalTaskCount            =  11;
    int64 activeThreads             =  12;
    int64 currentPoolSize           =  13;
    int64 maxPoolSize               =  14;
    int64 largestPoolSize           =  15;
    int64 queuedTaskCount           =  16;
}

/***************************************************************************/
/*******************************  JDBC Pool      ***************************/
/***************************************************************************/
message BrpcJdbcPoolMetricMessage {
    int64 timestamp                           =  1;
    int32 interval                            =  2;
    string driverClass                      =  3;
    string connectionString                 =  4;
    int64 activeCount                         =  5;
    optional int64 createCount                =  6;
    optional int64 destroyCount               =  7;
    optional int64 poolingCount               =  8;
    optional int64 poolingPeak                =  9;
    optional int64 activePeak                 =  10;
    optional int64 logicConnectCount          =  11;
    optional int64 logicCloseCount            =  12;
    optional int64 waitThreadCount            =  13;
    optional int64 createErrorCount           =  14;
    optional int64 executeCount               =  15;
    optional int64 commitCount                =  16;
    optional int64 rollbackCount              =  17;
    optional int64 startTransactionCount      =  18;
}

/***************************************************************************/
/*******************************  SQL             ***************************/
/***************************************************************************/
message BrpcSqlMetricMessage {
    int64 timestamp              =  1;
    int32 interval               =  2;
    string connectionString    =  3;
    int64 callCount              =  4;
    int64 responseTime           =  5;
    int64 minResponseTime        =  6;
    int64 maxResponseTime        =  7;
    int64 errorCount             =  8;
    int64 queryCount             =  9;
    int64 updateCount            =  10;
}

/***************************************************************************/
/*******************************  Redis          ***************************/
/***************************************************************************/
message BrpcRedisMetricMessage {
    int64 timestamp             = 1;
    string uri                = 2;
    string command            = 3;
    int32 interval              = 4;
    int64 exceptionCount        = 5;
    int64 totalCount            = 6;
    int64 minRequestTime        = 7;
    int64 requestTime           = 8;
    int64 maxRequestTime        = 9;
    int64 minResponseTime       = 10;
    int64 responseTime          = 11;
    int64 maxResponseTime       = 12;
    int64 requestBytes          = 13;
    int64 responseBytes         = 14;
}

/**************************************************************************/
/*******************************  MongoDb       ***************************/
/**************************************************************************/
message BrpcMongoDbMetricMessage {
    int64 timestamp            =  1;
    string server            =  2;
    string database          =  3;
    string collection        =  4;
    string command           =  5;
    int32 interval             =  6;
    int64 callCount            =  7;
    int64 exceptionCount       =  8;
    int64 responseTime         =  9;
    int64 minResponseTime      =  10;
    int64 maxResponseTime      =  11;
    int64 requestBytes         =  12;
    int64 responseBytes        =  13;
}

/**************************************************************************/
/*******************************  Generic Metric Message       ***************************/
/**************************************************************************/
message BrpcGenericDimensionSpec {
    string type = 1;
    string name = 2;
}

message BrpcGenericMetricSpec {
    string type = 1;
    string name = 2;
}

message BrpcGenericMetricSchema {
    string name = 1;
    repeated BrpcGenericDimensionSpec dimensionsSpec = 2;
    repeated BrpcGenericMetricSpec metricsSpec = 3;
}

message BrpcGenericMetricSet {
    repeated string dimension = 3;
    repeated int64  metric = 4;
}

message BrpcGenericMetricMessage {
    int64 timestamp            =  1;
    int64 interval             =  2;
    BrpcGenericMetricSchema schema = 3;
    repeated BrpcGenericMetricSet metricSet = 4;
}
