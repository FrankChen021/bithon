{
  "id": "jvm-metrics",
  "title": "JVM",
  "filter": {
    "selectors": [
      {
        "type": "datasource",
        "name": "jvm-metrics",
        "fields": [
          {
            "name": "appName",
            "width": 200,
            "allowClear": false
          },
          "instanceName"
        ]
      }
    ]
  },
  "charts": [
    {
      "title": "Instance List",
      "width": 4,
      "type": "table",
      "isCollapsed": true,
      "columns": [
        {
          "name": "index",
          "title": "No.",
          "format": "index",
          "sortable": false,
          "width": 80,
          "align": "center"
        },
        {
          "name": "instanceName",
          "title": "instance",
          "format": "template",
          "template": "<a href='/web/metrics/jvm-metrics?appName={appName}&instanceName={instanceName}&interval=c:{interval}'>{instanceName}</a>"
        },
        {
          "name": "processCpuLoad",
          "format": "percentage"
        },
        "processors",
        {
          "name": "instanceStartTime",
          "title": "startTime",
          "format": "dateTime"
        },
        {
          "name": "instanceUpTime",
          "title": "upTime",
          "format": "timeDuration"
        },
        {
          "name": "heapUsed",
          "format": "percentage"
        },
        {
          "name": "heapMax",
          "format": "binary_byte"
        }
      ],
      "query": {
        "dataSource": "jvm-metrics",
        "type": "groupBy",
        "fields": [
          {
            "name": "processors",
            "expression": "last(processors)"
          },
          {
            "name": "instanceStartTime",
            "expression": "last(instanceStartTime)"
          },
          {
            "name": "instanceUpTime",
            "expression": "last(instanceUpTime)"
          },
          {
            "name": "heapUsed",
            "expression": "round(last(heapUsed) * 100.0/max(heapMax), 2)"
          },
          {
            "name": "heapMax",
            "expression": "max(heapMax)"
          },
          {
            "name": "processCpuLoad",
            "expression": "avg(processCpuLoad)"
          }
        ],
        "groupBy": ["appName", "instanceName"],
        "orderBy": {
          "name": "instanceUpTime",
          "order": "asc"
        },
        "precondition": {
          "filters": ["appName"]
        }
      }
    },
    {
      "title": "CPU",
      "width": 2,
      "type": "line",
      "legend": {
        "placement": "inside",
        "values": ["min", "max", "avg"]
      },
      "columns": [
        {
          "name": "processCpuLoad",
          "format": "percentage"
        },
        {
          "name": "processors",
          "yAxis": 1,
          "fill": false
        }
      ],
      "query": {
        "type": "timeseries",
        "dataSource": "jvm-metrics",
        "fields": [
          {
            "name": "processCpuLoad",
            "expression": "avg(processCpuLoad)"
          },
          {
            "name": "processors",
            "expression": "last(processors)"
          }
        ],
        "precondition": {
          "filters": ["appName"]
        }
      }
    },
    {
      "title": "Threads",
      "width": 2,
      "type": "line",
      "columns": [
        "activeThreads",
        {
          "name": "totalThreads",
          "fill": false
        }
      ],
      "query": {
        "type": "timeseries",
        "dataSource": "jvm-metrics",
        "fields": [
          {
            "name": "activeThreads",
            "expression": "last(activeThreads)"
          },
          {
            "name": "totalThreads",
            "expression": "last(totalThreads)"
          }
        ]
      }
    },
    {
      "title": "Heap",
      "width": 1,
      "type": "line",
      "yAxis": [
        {
          "minInterval": 1048576,
          "format": "binary_byte"
        }
      ],
      "columns": [
        {
          "name": "heapUsed",
          "title": "used"
        },
        {
          "name": "heapMax",
          "title": "max",
          "fill": false
        },
        {
          "name": "heapCommitted",
          "title": "committed",
          "fill": false
        }
      ],
      "query": {
        "type": "timeseries",
        "dataSource": "jvm-metrics",
        "fields": [
          {
            "name": "heapUsed",
            "expression": "last(heapUsed)"
          },
          {
            "name": "heapMax",
            "expression": "last(heapMax)"
          },
          {
            "name": "heapCommitted",
            "expression": "last(heapCommitted)"
          }
        ]
      }
    },
    {
      "title": "Non-Heap",
      "width": 1,
      "type": "line",
      "yAxis": [
        {
          "minInterval": 1048576,
          "format": "binary_byte"
        }
      ],
      "columns": [
        {
          "name": "nonHeapUsed",
          "title": "used"
        },
        {
          "name": "nonHeapMax",
          "title": "max",
          "fill": false
        },
        {
          "name": "nonHeapCommitted",
          "title": "committed",
          "fill": false
        }
      ],
      "query": {
        "type": "timeseries",
        "dataSource": "jvm-metrics",
        "fields": [
          {
            "name": "nonHeapUsed",
            "expression": "last(nonHeapUsed)"
          },
          {
            "name": "nonHeapMax",
            "expression": "last(nonHeapMax)"
          },
          {
            "name": "nonHeapCommitted",
            "expression": "last(nonHeapCommitted)"
          }
        ]
      }
    },
    {
      "title": "Metaspace",
      "width": 1,
      "type": "line",
      "yAxis": [
        {
          "minInterval": 1048576,
          "format": "binary_byte"
        }
      ],
      "columns": [
        {
          "name": "metaspaceUsed",
          "title": "used"
        },
        {
          "name": "metaspaceMax",
          "title": "max",
          "fill": false
        },
        {
          "name": "metaspaceCommitted",
          "title": "committed",
          "fill": false
        }
      ],
      "query": {
        "type": "timeseries",
        "dataSource": "jvm-metrics",
        "fields": [
          {
            "name": "metaspaceUsed",
            "expression": "last(metaspaceUsed)"
          },
          {
            "name": "metaspaceMax",
            "expression": "last(metaspaceMax)"
          },
          {
            "name": "metaspaceCommitted",
            "expression": "last(metaspaceCommitted)"
          }
        ]
      }
    },
    {
      "title": "Direct Memory",
      "width": 1,
      "type": "line",
      "yAxis": [
        {
          "minInterval": 1048576,
          "format": "binary_byte"
        }
      ],
      "columns": [
        {
          "name": "directUsed",
          "title": "used"
        },
        {
          "name": "directMax",
          "title": "max",
          "fill": false
        }
      ],
      "query": {
        "type": "timeseries",
        "dataSource": "jvm-metrics",
        "fields": [
          {
            "name": "directUsed",
            "expression": "last(directUsed)"
          },
          {
            "name": "directMax",
            "expression": "last(directMax)"
          }
        ]
      }
    },
    {
      "title": "Young GC",
      "width": 4,
      "type": "line",
      "yAxis": [
        {},
        {
          "format": "millisecond"
        }
      ],
      "columns": [
        "gcCount",
        {
          "name": "avgGcTime",
          "yAxis": 1,
          "fill": false
        }
      ],
      "query": {
        "type": "timeseries",
        "dataSource": "jvm-gc-metrics",
        "fields": [
          {
            "name": "gcCount",
            "expression": "sum(gcCount)"
          },
          {
            "name": "avgGcTime",
            "expression": "sum(gcTime)/sum(gcCount)"
          }
        ],
        "groupBy": ["gcName"],
        "filter": "generation in ('new', 'ZGC Cycles', 'ZGC Pauses', 'ZGC Minor Cycles', 'ZGC Minor Pauses')"
      }
    },
    {
      "title": "Old GC",
      "width": 4,
      "type": "line",
      "yAxis": [
        {},
        {
          "format": "millisecond"
        }
      ],
      "columns": [
        "gcCount",
        {
          "name": "avgGcTime",
          "yAxis": 1,
          "fill": false
        }
      ],
      "query": {
        "type": "timeseries",
        "dataSource": "jvm-gc-metrics",
        "fields": [
          {
            "name": "gcCount",
            "expression": "sum(gcCount)"
          },
          {
            "name": "avgGcTime",
            "expression": "sum(gcTime)/sum(gcCount)"
          }
        ],
        "groupBy": ["gcName"],
        "filter": "generation in ('old', 'ZGC Major Cycles', 'ZGC Major Pauses')"
      }
    }
  ]
}
